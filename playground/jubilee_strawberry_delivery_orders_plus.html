<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ìœ ë¹Œë¦¬ ë”¸ê¸° íƒë°°</title>
  <style>
    :root{
      --rose-50:#fff1f2; --rose-100:#ffe4e6; --rose-500:#f43f5e; --rose-600:#e11d48; --rose-700:#be123c;
      --stone-900:#0c0a09; --stone-700:#44403c; --stone-600:#57534e; --stone-300:#d6d3d1;
      --gray:#e5e7eb; --blue:#3b82f6; --purple:#8b5cf6; --orange:#f97316; --teal:#14b8a6; --green:#16a34a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: ui-rounded, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", sans-serif;color:var(--stone-900);background:linear-gradient(#ffeef2,#fff)}
    a{text-decoration:none;color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}
    .btn{border:0;border-radius:14px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--rose-600);color:#fff}
    .btn-primary:hover{background:var(--rose-700)}
    .btn-ghost{background:#fff;border:1px solid var(--rose-100)}
    .btn-soft{background:#f8fafc;border:1px solid #e2e8f0}
    header{position:sticky;top:0;backdrop-filter:blur(6px);background:rgba(255,240,244,.8);border-bottom:1px solid var(--rose-100);z-index:50}
    header .wrap{height:64px;display:flex;align-items:center;justify-content:space-between}
    nav{display:none;gap:18px}
    @media(min-width:640px){nav{display:flex}}
    h1{font-size:36px;margin:0}
    h2{font-size:26px;margin:0 0 14px 0;color:var(--rose-700)}
    section{padding:56px 0}
    .cards{display:grid;gap:16px}
    @media(min-width:768px){.cards{grid-template-columns:repeat(3,1fr)}}
    .card{background:#fff;border-radius:18px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:20px}
    .hero{padding:48px 0;background:linear-gradient(var(--rose-100),var(--rose-50))}
    .grid2{display:grid;gap:24px}
    @media(min-width:768px){.grid2{grid-template-columns:1fr 1fr}}
    .strawdy{display:grid;grid-template-columns:repeat(5,64px);gap:12px;place-content:center}
    .berry{width:64px;height:80px;border-radius:38px;background:var(--rose-500);position:relative;box-shadow:0 8px 16px rgba(244,63,94,.25)}
    .berry::before{content:'';position:absolute;left:50%;transform:translateX(-50%);top:-16px;width:34px;height:24px;background:#22c55e;border-radius:16px 16px 4px 4px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:100}
    .modal.open{display:flex}
    .dialog{background:#fff;border-radius:20px;max-width:860px;width:100%;padding:20px;box-shadow:0 16px 50px rgba(0,0,0,.2)}
    .row{display:grid;gap:12px}
    @media(min-width:640px){.row-2{grid-template-columns:1fr 1fr} .row-3{grid-template-columns:1fr 1fr 1fr}}
    label span{display:block;font-size:13px;font-weight:700;color:var(--stone-700)}
    .field{width:100%;padding:12px 14px;border:1px solid var(--stone-300);border-radius:12px;outline:none}
    .progress{height:10px;border-radius:999px;background:#eee;overflow:hidden}
    .bar{height:100%;width:0;background:var(--rose-500);transition:width .25s}
    .footer{background:#fff;border-top:1px solid var(--rose-100);padding:28px 0;margin-top:24px;font-size:14px;color:var(--stone-600)}
    .list{padding-left:18px}
    .review{font-weight:700}
    .orders{display:grid;gap:12px;max-height:60vh;overflow:auto;margin-top:10px}
    .order{border:1px solid #e5e7eb;border-radius:14px;padding:12px;display:grid;gap:8px;background:#fff}
    .order-head{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap}
    .order-meta{display:flex;gap:10px;flex-wrap:wrap;font-size:13px;color:#475569}
    .pill{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:6px 10px;font-weight:700;font-size:12px;color:#fff}
    .s0{background:var(--gray);color:#0f172a}
    .s1{background:var(--blue)}
    .s2{background:var(--purple)}
    .s3{background:var(--orange)}
    .s4{background:var(--teal)}
    .s5{background:var(--green)}
    .actions{display:flex;gap:6px;flex-wrap:wrap}
    .order .progress{height:8px}
    .muted{color:#6b7280;font-size:12px}
    .danger{background:#fee2e2;border:1px solid #fecaca}
    .inline{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <header>
    <div class="container wrap">
      <div style="display:flex;align-items:center;gap:10px">
        <div aria-hidden="true" style="width:40px;height:40px;border-radius:12px;background:conic-gradient(from 0deg,#ff9aa2,#ff5d73,#ff3b5e)"></div>
        <strong>ìœ ë¹Œë¦¬ ë”¸ê¸° íƒë°°</strong>
      </div>
      <nav>
        <a href="#about">ì†Œê°œ</a>
        <a href="#how">ë°°ë‹¬</a>
        <a href="#menu">ë©”ë‰´/ê°€ê²©</a>
        <a href="#safety">ì•ˆì „</a>
      </nav>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost" id="ordersBtn">ì£¼ë¬¸ ë¦¬ìŠ¤íŠ¸</button>
        <button class="btn btn-ghost" id="trackBtn">ì¶”ì  ë†€ì´</button>
        <button class="btn btn-primary" id="orderBtn">ì£¼ë¬¸í•˜ê¸°</button>
      </div>
    </div>
  </header>

  <main>
    <div class="hero">
      <div class="container grid2">
        <div>
          <h1>ë‹¤ì„¯ ì‚´ ìš°ì§„ì´ê°€ ìš´ì˜í•˜ëŠ” <span style="color:var(--rose-700)">ìœ ë¹Œë¦¬ ë”¸ê¸° íƒë°°</span></h1>
          <p style="color:var(--stone-700);font-size:18px;margin-top:10px">ì‹±ì‹±í•œ ğŸ“ë¥¼ ì¡°ì‹¬ì¡°ì‹¬ ìƒìì— ë‹´ì•„, ë¹ ë¥´ê³  ì¦ê²ê²Œ ë°°ë‹¬í•´ìš”! ë¶€ëª¨ë‹˜ê³¼ í•¨ê»˜ ì£¼ë¬¸í•´ ì£¼ì„¸ìš”.</p>
          <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-primary" id="orderBtn2">ì§€ê¸ˆ ì£¼ë¬¸í•˜ê¸°</button>
            <a class="btn btn-ghost" href="#how">ë°°ë‹¬ ë°©ë²• ë³´ê¸°</a>
          </div>
        </div>
        <div class="card" style="display:grid;place-items:center">
          <div class="strawdy">
            <div class="berry"></div><div class="berry"></div><div class="berry"></div><div class="berry"></div><div class="berry"></div>
          </div>
          <p style="margin-top:10px;color:#777;font-size:13px">ê·€ì—¬ìš´ ë”¸ê¸° í–‰ì§„!</p>
        </div>
      </div>
    </div>

    <section id="about" class="container">
      <h2>ê°€ê²Œ ì†Œê°œ</h2>
      <div class="cards">
        <div class="card">
          <div style="font-size:36px">ğŸ§’ğŸ»</div>
          <h3>ì‚¬ì¥ë‹˜: ì´ìš°ì§„(5ì„¸)</h3>
          <p style="color:var(--stone-700)">ì¸ì‚¬ ì˜í•˜ê³  ìƒìë„ ì˜ ë“¤ì–´ìš”. í˜ì€ ê°€ë³ì§€ë§Œ ë§ˆìŒì€ ë“ ë“ í•´ìš”!</p>
        </div>
        <div class="card">
          <div style="font-size:36px">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
          <h3>í•¨ê»˜ ìš´ì˜í•´ìš”</h3>
          <p style="color:var(--stone-700)">ë³´í˜¸ìì™€ í•¨ê»˜ ì•ˆì „í•˜ê²Œ ìš´ì˜í•©ë‹ˆë‹¤. ê²°ì œÂ·ì£¼ì†Œ í™•ì¸ ë“±ì€ ëª¨ë‘ ë³´í˜¸ìê°€ í•´ìš”.</p>
        </div>
        <div class="card">
          <div style="font-size:36px">ğŸ’Œ</div>
          <h3>í–‰ë³µ ë°°ë‹¬</h3>
          <p style="color:var(--stone-700)">ì‹±ì‹±í•œ ë”¸ê¸°ì™€ í•¨ê»˜ ê°ì‚¬ í¸ì§€ ìŠ¤í‹°ì»¤ë„ ë³´ë‚´ë“œë ¤ìš”.</p>
        </div>
      </div>
    </section>

    <section id="how" class="container">
      <h2>ì–´ë–»ê²Œ ë°°ë‹¬í•´ìš”?</h2>
      <div class="cards">
        <div class="card"><div style="font-size:36px">ğŸ§º</div><h3>ìˆ˜í™•</h3><p>ê¹¨ë—í•œ ê³³ì—ì„œ ì‹ ì„ í•œ ë”¸ê¸°ë¥¼ ê³ ë¦…ë‹ˆë‹¤.</p></div>
        <div class="card"><div style="font-size:36px">ğŸ“¦</div><h3>í¬ì¥</h3><p>í‘¹ì‹ í•œ ì¢…ì´ì™€ ì•„ì´ ì‚¬ë‘ìœ¼ë¡œ í¬ì¥!</p></div>
        <div class="card"><div style="font-size:36px">ğŸšš</div><h3>ë°°ë‹¬</h3><p>ì•ˆì „ë²¨íŠ¸ í•˜ê³  ì¡°ì‹¬ì¡°ì‹¬ ì¶œë°œ!</p></div>
      </div>
    </section>

    <section id="menu" class="container">
      <h2>ë©”ë‰´ / ê°€ê²©</h2>
      <div class="cards">
        <div class="card"><h3>ì‘ì€ ìƒì</h3><p>ëŒ€ëµ 0.5 kg</p><p style="font-weight:800;font-size:22px">â‚© 8,000</p><button class="btn btn-primary smallOrder">ì£¼ë¬¸í•˜ê¸°</button></div>
        <div class="card"><h3>ë³´í†µ ìƒì</h3><p>ëŒ€ëµ 1 kg</p><p style="font-weight:800;font-size:22px">â‚© 14,000</p><button class="btn btn-primary smallOrder">ì£¼ë¬¸í•˜ê¸°</button></div>
        <div class="card"><h3>í–‰ë³µ ìƒì</h3><p>ëŒ€ëµ 2 kg</p><p style="font-weight:800;font-size:22px">â‚© 26,000</p><button class="btn btn-primary smallOrder">ì£¼ë¬¸í•˜ê¸°</button></div>
      </div>
    </section>

    <section id="safety" class="container">
      <h2>ì•ˆì „ Â· ë³´í˜¸ì ì•ˆë‚´</h2>
      <div class="card">
        <ul class="list">
          <li>ëª¨ë“  ì£¼ë¬¸Â·ì—°ë½ì€ ë°˜ë“œì‹œ <b>ë³´í˜¸ì</b>ê°€ ì§„í–‰í•´ ì£¼ì„¸ìš”.</li>
          <li>ê°œì¸ì •ë³´ëŠ” ì£¼ë¬¸ í™•ì¸ì—ë§Œ ì‚¬ìš©í•˜ë©°, ì‚¬ì´íŠ¸ì— ì €ì¥í•˜ì§€ ì•Šì•„ìš”. (ë°ëª¨ì—ì„œëŠ” ë¸Œë¼ìš°ì €ì— ì„ì‹œ ì €ì¥)</li>
          <li>ì•Œë ˆë¥´ê¸°ë‚˜ ìš”ì²­ ì‚¬í•­ì€ ì£¼ë¬¸ ë©”ëª¨ì— ê¼­ ì ì–´ì£¼ì„¸ìš”.</li>
        </ul>
      </div>
    </section>

    <section class="container">
      <h2>ì‘ì€ ë¦¬ë·°</h2>
      <div class="cards">
        <div class="card"><p class="review">â€œë”¸ê¸°ê°€ ë‹¬ê³  ì‹±ì‹±í•´ìš”!â€</p><p>â€” ìš°ì§„ì´ê°€ ì§ì ‘ ê³ ë¥¸ëŒ€ìš”.</p></div>
        <div class="card"><p class="review">â€œìƒìê°€ ê·€ì—¬ì›Œìš”â€</p><p>â€” ìŠ¤í‹°ì»¤ê°€ í¬ì¸íŠ¸!</p></div>
        <div class="card"><p class="review">â€œë°°ë‹¬ì´ ë¹ ë¥´ë„¤ìš”â€</p><p>â€” ê¸¸ì—ì„œëŠ” í•­ìƒ ì¡°ì‹¬ì¡°ì‹¬~</p></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container" style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div><strong>ìœ ë¹Œë¦¬ ë”¸ê¸° íƒë°°</strong><div style="color:var(--stone-600);font-size:13px">Â© <span id="year"></span> Woojin Delivery. All smiles reserved ğŸ˜Š</div></div>
      <div style="color:var(--stone-600);font-size:13px">*í•™ìŠµ/ë†€ì´ìš© ë°ëª¨ í˜ì´ì§€</div>
    </div>
  </footer>

  <!-- ì£¼ë¬¸ ëª¨ë‹¬ -->
  <div class="modal" id="orderModal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">ì£¼ë¬¸í•˜ê¸°</h3>
        <button class="btn btn-ghost" id="closeOrder">ë‹«ê¸°</button>
      </div>
      <form id="orderForm" class="row" autocomplete="on">
        <div class="row row-2">
          <label><span>ë³´í˜¸ì ì„±í•¨ *</span><input required class="field" name="guardian"></label>
          <label><span>ì—°ë½ì²˜ *</span><input required class="field" name="phone" placeholder="010-0000-0000"></label>
        </div>
        <label><span>ì£¼ì†Œ *</span><input required class="field" name="address"></label>
        <div class="row row-3">
          <label><span>ìƒì í¬ê¸°</span>
            <select class="field" name="size">
              <option>ì‘ì€ ìƒì</option><option selected>ë³´í†µ ìƒì</option><option>í–‰ë³µ ìƒì</option>
            </select>
          </label>
          <label><span>ìˆ˜ëŸ‰</span><input type="number" min="1" max="9" value="1" class="field" name="qty"></label>
          <label><span>í¬ë§ ë°°ì†¡ì¼</span><input type="date" class="field" name="date"></label>
        </div>

        <div class="row row-3">
          <label><span>ê³¼ì¼ ì„ íƒ</span>
            <select class="field" name="fruit" id="fruitSelect"></select>
          </label>
          <label><span>ìƒˆ ê³¼ì¼ ì¶”ê°€</span>
            <div class="inline">
              <input class="field" id="fruitAddInput" placeholder="ì˜ˆ: í¬ë„, ë¸”ë£¨ë² ë¦¬ ë“±">
              <button class="btn btn-soft" type="button" id="fruitAddBtn">ì¶”ê°€</button>
            </div>
          </label>
          <label id="fruitEtcWrap" style="display:none"><span>ê¸°íƒ€ ê³¼ì¼ (ì§ì ‘ ì…ë ¥)</span>
            <input class="field" name="fruitEtc" placeholder="ìì„¸í•œ í’ˆì¢…/ë©”ëª¨ ë“±">
          </label>
        </div>

        <label><span>ë©”ëª¨</span><textarea rows="3" class="field" name="memo" placeholder="ì•Œë ˆë¥´ê¸°/ìš”ì²­ì‚¬í•­ ë“±ì„ ì ì–´ì£¼ì„¸ìš”"></textarea></label>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <p style="color:var(--stone-600);font-size:13px">ì œì¶œí•˜ë©´ ë¸Œë¼ìš°ì €ì—ë§Œ ì„ì‹œ ì €ì¥ë©ë‹ˆë‹¤. (ë°ëª¨)</p>
          <button class="btn btn-primary" type="submit">ì œì¶œ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ì¶”ì  ë†€ì´ ëª¨ë‹¬ (ê°œë³„) -->
  <div class="modal" id="trackModal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">ë°°ì†¡ ì¶”ì  ë†€ì´</h3>
        <button class="btn btn-ghost" id="closeTrack">ë‹«ê¸°</button>
      </div>
      <div style="margin-top:10px">
        <div style="display:flex;justify-content:space-between;color:var(--stone-600);font-size:13px">
          <span id="stepLabel">ì£¼ë¬¸ ì ‘ìˆ˜</span>
          <span><span id="stepNow">1</span> / <span id="stepTotal">6</span></span>
        </div>
        <div class="progress" style="margin-top:6px"><div id="bar" class="bar"></div></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn btn-ghost" id="prevStep">ì´ì „</button>
          <button class="btn btn-primary" id="nextStep">ë‹¤ìŒ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì£¼ë¬¸ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ (ê´€ë¦¬ì ë·°) -->
  <div class="modal" id="ordersModal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
        <h3 style="margin:0">ì£¼ë¬¸ ë¦¬ìŠ¤íŠ¸</h3>
        <div class="actions">
          <button class="btn btn-soft" id="exportCsv">CSVë¡œ ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn btn-ghost" id="closeOrders">ë‹«ê¸°</button>
        </div>
      </div>
      <div class="muted" style="margin-top:6px">ê° ì£¼ë¬¸ì˜ ì§„í–‰ ë‹¨ê³„ë¥¼ ì§ì ‘ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”. ìƒ‰ê¹”ë¡œ ìƒíƒœê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
      <div class="orders" id="ordersContainer"></div>
      <div class="muted" style="margin-top:6px">* ë°ì´í„°ëŠ” ì´ ë¸Œë¼ìš°ì €ì˜ localStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script>
    // ==== Storage keys ====
    const STORAGE_KEY='jubilee-orders';
    const FRUITS_KEY='jubilee-fruits';

    // ==== Fruits preset & utils ====
    const DEFAULT_FRUITS=[
      {label:'ğŸ“ ë”¸ê¸°', value:'ë”¸ê¸°'},
      {label:'ğŸ‘ ë³µìˆ­ì•„', value:'ë³µìˆ­ì•„'},
      {label:'ğŸ‡ í¬ë„', value:'í¬ë„'},
      {label:'ğŸ« ë¸”ë£¨ë² ë¦¬', value:'ë¸”ë£¨ë² ë¦¬'},
      {label:'ğŸ ì‚¬ê³¼', value:'ì‚¬ê³¼'},
      {label:'ğŸŠ ê·¤', value:'ê·¤'},
      {label:'ğŸŒ ë°”ë‚˜ë‚˜', value:'ë°”ë‚˜ë‚˜'},
      {label:'âœï¸ ê¸°íƒ€(ì§ì ‘ ì…ë ¥)', value:'etc'}
    ];
    const FRUIT_ICON_MAP={
      'ë”¸ê¸°':'ğŸ“','ë³µìˆ­ì•„':'ğŸ‘','í¬ë„':'ğŸ‡','ë¸”ë£¨ë² ë¦¬':'ğŸ«','ì‚¬ê³¼':'ğŸ','ê·¤':'ğŸŠ','ë°”ë‚˜ë‚˜':'ğŸŒ'
    };
    const fruitIcon=(name)=> FRUIT_ICON_MAP[name] || 'ğŸ‡';

    const getFruits=()=>{
      try{
        const saved=JSON.parse(localStorage.getItem(FRUITS_KEY)||'[]');
        // Merge saved with defaults ensuring 'etc' at end
        const filteredDefaults=DEFAULT_FRUITS.filter(d=>!saved.some(s=>s.value===d.value));
        const merged=[...saved, ...filteredDefaults.filter(d=>d.value!=='etc')];
        // ensure etc last
        if(!merged.some(x=>x.value==='etc')) merged.push({label:'âœï¸ ê¸°íƒ€(ì§ì ‘ ì…ë ¥)', value:'etc'});
        return merged;
      }catch{return DEFAULT_FRUITS}
    };
    const setFruits=(arr)=>localStorage.setItem(FRUITS_KEY, JSON.stringify(arr));

    // ==== Orders utils ====
    const getOrders=()=>{try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')}catch{return []}};
    const setOrders=(arr)=>localStorage.setItem(STORAGE_KEY,JSON.stringify(arr));
    const steps=['ì£¼ë¬¸ ì ‘ìˆ˜','ë”¸ê¸° ë”°ëŠ” ì¤‘','ì‹ ì„  í¬ì¥','ìš°ì§„ì´ ì¶œë°œ!','ë°°ë‹¬ ì¤‘','ë„ì°©!'];
    const stepClass=['s0','s1','s2','s3','s4','s5'];

    // ==== Header buttons & modals ====
    const orderBtn=document.getElementById('orderBtn');
    const orderBtn2=document.getElementById('orderBtn2');
    const trackBtn=document.getElementById('trackBtn');
    const ordersBtn=document.getElementById('ordersBtn');
    const orderModal=document.getElementById('orderModal');
    const trackModal=document.getElementById('trackModal');
    const ordersModal=document.getElementById('ordersModal');
    const closeOrder=document.getElementById('closeOrder');
    const closeTrack=document.getElementById('closeTrack');
    const closeOrders=document.getElementById('closeOrders');
    document.querySelectorAll('.smallOrder').forEach(b=>b.addEventListener('click',()=>open(orderModal)));
    orderBtn.onclick=orderBtn2.onclick=()=>open(orderModal);
    trackBtn.onclick=()=>open(trackModal);
    ordersBtn.onclick=()=>{renderOrders(); open(ordersModal);};
    closeOrder.onclick=()=>close(orderModal);
    closeTrack.onclick=()=>close(trackModal);
    closeOrders.onclick=()=>close(ordersModal);
    function open(el){el.classList.add('open')}
    function close(el){el.classList.remove('open')}
    window.addEventListener('keydown',e=>{if(e.key==='Escape'){[orderModal,trackModal,ordersModal].forEach(close)}});

    // ==== Order form ====
    const form=document.getElementById('orderForm');
    const fruitSelect=document.getElementById('fruitSelect');
    const fruitEtcWrap=document.getElementById('fruitEtcWrap');
    const fruitAddInput=document.getElementById('fruitAddInput');
    const fruitAddBtn=document.getElementById('fruitAddBtn');

    function renderFruitOptions(){
      const fruits=getFruits();
      fruitSelect.innerHTML='';
      fruits.forEach(f=>{
        const op=document.createElement('option');
        op.value=f.value; op.textContent=f.label;
        fruitSelect.appendChild(op);
      });
      onFruitChange();
    }

    function onFruitChange(){
      fruitEtcWrap.style.display = fruitSelect.value==='etc' ? 'block' : 'none';
    }
    fruitSelect.addEventListener('change', onFruitChange);

    fruitAddBtn.addEventListener('click', ()=>{
      const name=(fruitAddInput.value||'').trim();
      if(!name) return;
      // Prevent duplicates and reserved 'etc'
      if(name==='ê¸°íƒ€' || name.toLowerCase()==='etc') return alert('ì´ ì´ë¦„ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ìš”.');
      const fruits=getFruits().filter(f=>f.value!=='etc'); // remove etc temporarily
      if(fruits.some(f=>f.value===name)){ alert('ì´ë¯¸ ìˆëŠ” ê³¼ì¼ì´ì—ìš”.'); return; }
      const icon=FRUIT_ICON_MAP[name] || 'ğŸ'; // unknown gets pineapple icon for fun
      fruits.push({label:`${icon} ${name}`, value:name});
      fruits.push({label:'âœï¸ ê¸°íƒ€(ì§ì ‘ ì…ë ¥)', value:'etc'});
      setFruits(fruits);
      fruitAddInput.value='';
      renderFruitOptions();
      fruitSelect.value=name;
      onFruitChange();
    });

    renderFruitOptions();

    form.addEventListener('submit',(e)=>{
      e.preventDefault();
      const data=Object.fromEntries(new FormData(form).entries());
      const fruitFinal = data.fruit==='etc' ? (data.fruitEtc||'ê¸°íƒ€') : data.fruit;
      const order={
        id: Date.now(),
        guardian: data.guardian?.trim(),
        phone: data.phone?.trim(),
        address: data.address?.trim(),
        size: data.size,
        qty: Number(data.qty||1),
        date: data.date||'',
        memo: data.memo?.trim(),
        fruit: fruitFinal,
        progress: 0
      };
      try{
        const arr=getOrders(); arr.push(order); setOrders(arr);
        alert('ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆì–´ìš”! ê°ì‚¬í•©ë‹ˆë‹¤.');
        form.reset(); renderFruitOptions();
        close(orderModal);
      }catch(err){ alert('ì €ì¥ì´ ë˜ì§€ ì•Šì•˜ì–´ìš”.'); }
    });

    // ==== Single tracking play (demo) ====
    let idx=0;
    const label=document.getElementById('stepLabel');
    const now=document.getElementById('stepNow');
    const total=document.getElementById('stepTotal');
    total.textContent=steps.length;
    const bar=document.getElementById('bar');
    function renderDemo(){label.textContent=steps[idx]; now.textContent=idx+1; bar.style.width=((idx+1)/steps.length*100)+'%';}
    renderDemo();
    document.getElementById('prevStep').onclick=()=>{idx=Math.max(0,idx-1);renderDemo()}
    document.getElementById('nextStep').onclick=()=>{idx=Math.min(steps.length-1,idx+1);renderDemo()}

    // ==== Orders admin view ====
    const ordersContainer=document.getElementById('ordersContainer');

    function renderOrders(){
      const arr=getOrders();
      ordersContainer.innerHTML='';
      if(arr.length===0){
        const empty=document.createElement('div');
        empty.className='order danger';
        empty.textContent='ì•„ì§ ì£¼ë¬¸ì´ ì—†ì–´ìš”.';
        ordersContainer.appendChild(empty);
        return;
      }
      arr.sort((a,b)=>b.id-a.id);
      for(const o of arr){
        const wrap=document.createElement('div');
        wrap.className='order';

        const head=document.createElement('div');
        head.className='order-head';
        const title=document.createElement('div');
        const shortId = String(o.id).slice(-6);
        const icon = fruitIcon(o.fruit);
        title.innerHTML = `<strong>${icon} ${o.fruit}</strong> Â· ${o.size} Â· x${o.qty} <span class="muted">#${shortId}</span>`;

        const status=document.createElement('div');
        const pill=document.createElement('span');
        pill.className='pill '+ stepClass[o.progress??0];
        pill.innerHTML = `${o.progress+1}/${steps.length} Â· ${steps[o.progress??0]}`;
        status.appendChild(pill);

        head.appendChild(title);
        head.appendChild(status);

        const meta=document.createElement('div');
        meta.className='order-meta';
        meta.innerHTML = `ğŸ‘¤ ${o.guardian||'-'} Â· ğŸ“ ${o.phone||'-'} Â· ğŸ—“ï¸ ${o.date||'-'} Â· ğŸ“ ${o.address||'-'}`;

        const prog=document.createElement('div');
        prog.className='progress';
        const b=document.createElement('div');
        b.className='bar';
        b.style.width = (((o.progress??0)+1)/steps.length*100)+'%';
        prog.appendChild(b);

        const ctrls=document.createElement('div');
        ctrls.className='actions';
        const prev=document.createElement('button');
        prev.className='btn btn-soft';
        prev.textContent='ì´ì „';
        const next=document.createElement('button');
        next.className='btn btn-primary';
        next.textContent='ë‹¤ìŒ';
        const select=document.createElement('select');
        select.className='field';
        select.style.width='auto';
        steps.forEach((s,i)=>{
          const op=document.createElement('option');
          op.value=i; op.textContent=`${i+1}. ${s}`;
          if(i===(o.progress??0)) op.selected=true;
          select.appendChild(op);
        });
        const del=document.createElement('button');
        del.className='btn btn-ghost';
        del.textContent='ì‚­ì œ';

        ctrls.appendChild(prev);
        ctrls.appendChild(next);
        ctrls.appendChild(select);
        ctrls.appendChild(del);

        wrap.appendChild(head);
        wrap.appendChild(meta);
        wrap.appendChild(prog);
        wrap.appendChild(ctrls);
        ordersContainer.appendChild(wrap);

        prev.onclick=()=>{ updateProgress(o.id, Math.max(0, (o.progress??0)-1)); };
        next.onclick=()=>{ updateProgress(o.id, Math.min(steps.length-1, (o.progress??0)+1)); };
        select.onchange=(e)=>{ updateProgress(o.id, parseInt(e.target.value,10)); };
        del.onclick=()=>{
          if(confirm('ì´ ì£¼ë¬¸ì„ ì‚­ì œí• ê¹Œìš”?')){
            const arr=getOrders().filter(x=>x.id!==o.id); setOrders(arr); renderOrders();
          }
        };
      }
    }

    function updateProgress(id, p){
      const arr=getOrders();
      const i=arr.findIndex(x=>x.id===id);
      if(i>-1){
        arr[i].progress=p;
        setOrders(arr);
        renderOrders();
      }
    }

    // ==== CSV export ====
    document.getElementById('exportCsv').addEventListener('click', ()=>{
      const rows=getOrders();
      if(rows.length===0){ alert('ë‚´ë³´ë‚¼ ì£¼ë¬¸ì´ ì—†ì–´ìš”.'); return; }
      const header=['id','guardian','phone','address','size','qty','date','memo','fruit','progress','progressLabel'];
      const lines=[header.join(',')];
      rows.forEach(o=>{
        const vals=[
          o.id, q(o.guardian), q(o.phone), q(o.address),
          q(o.size), o.qty, q(o.date), q(o.memo), q(o.fruit),
          o.progress, q(steps[o.progress||0])
        ];
        lines.push(vals.join(','));
      });
      const blob=new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='orders.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });
    function q(v){ if(v==null) return ''; const s=String(v).replaceAll('"','""'); return `"${s}"`; }

    // year
    document.getElementById('year').textContent=new Date().getFullYear();
  </script>
</body>
</html>
