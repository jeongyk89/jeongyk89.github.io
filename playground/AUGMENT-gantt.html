<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Gantt — WPs with locked colors + details</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:16px}
    h2{margin:0 0 8px}
    .legend{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 14px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border:1px solid #ddd;border-radius:999px;font-size:12px}
    .sw{width:12px;height:12px;border-radius:2px;display:inline-block}
    #details{margin-top:16px;padding:14px;border:1px solid #e5e7eb;border-radius:12px;background:#fafafa}
    #details h3{margin:0 0 6px;font-size:16px}
    #details .meta{display:flex;gap:16px;flex-wrap:wrap;color:#334155;font-size:13px;margin-bottom:6px}
    #details p{margin:8px 0 0;line-height:1.4}
    .muted{color:#64748b}
    .tt{padding:6px 8px}
  </style>
  <script>
    google.charts.load('current', {'packages':['timeline']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart(){
      const el = document.getElementById('gantt');
      const chart = new google.visualization.Timeline(el);
      const data = new google.visualization.DataTable();
      data.addColumn({type:'string', id:'WP'});
      data.addColumn({type:'string', id:'Item'});
      data.addColumn({type:'date', id:'Start'});
      data.addColumn({type:'date', id:'End'});
      data.addColumn({type:'string', role:'style'});                  // LOCKED COLORS
      data.addColumn({type:'string', role:'tooltip', p:{html:true}}); // rich tooltip

      // --- helpers ---
      const baseYear = 2025;
      const M  = m => new Date(baseYear, m-1, 1);
      const Md = m => new Date(baseYear, m-1, 2); // 1-day marker
      const fmt = m => M(m).toLocaleString('en-GB', {month:'short', year:'numeric'});

      // Palette (UoP=orange, UH=green)
      const COLOR_MAP = {
        KTH:   '#1f77b4',  // blue
        UOP:   '#ff7f0e',  // orange (UoP)
        UH:    '#2ca02c',  // green  (UH/UoH)
        SKKU:  '#9467bd',  // purple
        SNU:   '#8c564b',  // brown
        AICT:  '#e377c2',  // pink
        HDKSOE:'#7f7f7f',  // gray
        NMT:   '#bcbd22',  // olive
        IDL:   '#17becf'   // cyan
      };
      const DELIV = '#444';    // deliverables
      const MILES = '#2b8a3e'; // milestones

      // Normalize partner labels to palette keys
      const norm = s => String(s).toUpperCase().replace(/\s+/g,'').replace(/\./g,'')
        .replace(/^UP$/, 'UOP')   // alias for UoP
        .replace(/^UOH$/, 'UH');  // alias for UH

      // Use all three keys to prevent Google overriding the color
      const styleFor = hex => [
        `color:${hex}`,           // <- generic color
        `stroke-color:${hex}`,    // <- border
        `stroke-width:2`,
        `fill-color:${hex}`,      // <- fill
        `fill-opacity:0.95`
      ].join(';');

      const tip = (title, type, lead, s, e, desc, color) => `
        <div class="tt" style="border-left:4px solid ${color}">
          <div style="font-weight:600">${title}</div>
          <div class="muted" style="font-size:12px">${type} • Lead: ${lead}</div>
          <div class="muted" style="font-size:12px">${s?'Start: '+fmt(s):''}${e?' • End/Due: '+fmt(e):''}</div>
          <div style="margin-top:6px;max-width:420px">${desc||''}</div>
        </div>`;

      const registry = {};
      const rows = [];
      const T = (wp, label, s, e, lead, desc) => {
        const key = `${wp}|Task ${label} (${lead})`;
        const hex = COLOR_MAP[norm(lead)] || '#999';
        registry[key] = {wp,type:'Task',label:`Task ${label}`,lead,start:s,end:e,desc};
        rows.push([wp, `Task ${label} (${lead})`, M(s), M(e), styleFor(hex), tip(`Task ${label}`,'Task',lead,s,e,desc,hex)]);
      };
      const D = (wp, code, month, lead, desc) => {
        const key = `${wp}|Deliverable ${code} (${lead})`;
        registry[key] = {wp,type:'Deliverable',label:`Deliverable ${code}`,lead,start:month,end:month,desc};
        rows.push([wp, `Deliverable ${code} (${lead})`, M(month), Md(month), styleFor(DELIV), tip(`Deliverable ${code}`,'Deliverable',lead,month,month,desc,DELIV)]);
      };
      const MS = (wp, code, month, lead, desc) => {
        const key = `${wp}|Milestone ${code} (${lead})`;
        registry[key] = {wp,type:'Milestone',label:`Milestone ${code}`,lead,start:month,end:month,desc};
        rows.push([wp, `Milestone ${code} (${lead})`, M(month), Md(month), styleFor(MILES), tip(`Milestone ${code}`,'Milestone',lead,month,month,desc,MILES)]);
      };

      // ------------------ DATA ------------------

      // WP1 (UoP should appear ORANGE)
      T('WP1','1.1 Literature review on I5.0 implementation roadmaps',2,9,'UoP','PRISMA review of augmentation tech.');
      T('WP1','1.2 Human-centric requirements & tools for augmentation design',3,12,'UoP','Socio-technical protocol & tools.');
      T('WP1','1.3 Hands-on training for work-centred design',9,26,'UoP','Training for managers/engineers/teams/reps.');
      T('WP1','1.4 Voice 5.0 – Assessment of augmentation technologies',27,48,'UoP','Acceptance/impact across phases.');
      T('WP1','1.5 Multi-level Training Framework for Reskilling/Upskilling',26,48,'UoP','Reskilling & social dialogue framework.');
      D('WP1','D1.1',12,'UoP','Fieldwork Methodological Roadmap.');
      D('WP1','D1.2',42,'UoP','I5.0 skills & social dialogue framework.');
      MS('WP1','M1.1',9,'UoP','Review protocol registered (OSF).');
      MS('WP1','M1.2',26,'UoP','Data collection guide validated.');
      MS('WP1','M1.3',38,'UoP','Voice 5.0 beta piloted.');
      MS('WP1','M1.4',48,'UoP','Scientific dissemination completed.');

      // WP2 (UH should appear GREEN)
      T('WP2','2.1 Identify requirements for integrating AI agents & PRC tech',6,24,'UH','Co-designed technical/operational requirements.');
      T('WP2','2.2 Define interoperability & data exchange for AI agents',12,24,'UH','DT-anchored data lifecycle; APIs; privacy-by-design.');
      T('WP2','2.3 Develop guidelines & design principles for adaptive AI agents',12,30,'UH','Adaptive/personalised guidelines.');
      T('WP2','2.4 Evaluate acceptance of AI agent augmentation',18,46,'UH','Lab + industrial acceptance/usability + KPI impact.');
      T('WP2','2.5 Assess ethical, privacy & policy implications of AI agents',18,46,'UH','GDPR/AI Act review; case studies; fairness/explainability.');
      D('WP2','D2.1',30,'UoH','Guidelines for adaptive & personalised AI agents.');
      D('WP2','D2.2',46,'UoH','Integrated AI agent models validated & ready.');
      MS('WP2','M2.1',24,'UH','Consortium-approved AI guidelines.');
      MS('WP2','M2.2',42,'UH','Models validated in lab; GDPR checklist.');

      // WP3
      T('WP3','3.1 Specification of Data Standards for Federated AI & DTs',1,36,'SKKU','Human/site data taxonomy + schema.');
      T('WP3','3.2 Interoperability Specification for DTs',19,42,'SKKU','DT interfaces, sync & data flows.');
      T('WP3','3.3 Interoperability Specification for AI Models',19,42,'AICT','Model I/O, formats, portability.');
      T('WP3','3.4 Validation Pipelines & Interoperability Benchmarks',25,48,'AICT','Pipelines + KPIs for latency/reuse/compatibility.');
      D('WP3','D3.1',18,'SKKU','Data taxonomy & standard schema.');
      D('WP3','D3.2',36,'SKKU','Scenario specification & semantic mapping.');
      D('WP3','D3.4',45,'SKKU','KPI & interoperability benchmark report.');
      MS('WP3','M3.1',15,'SKKU','Taxonomy & schema validated.');
      MS('WP3','M3.2',33,'SKKU','Use-case mappings finalised.');
      MS('WP3','M3.3',42,'AICT','Pipelines & benchmarks operational.');

      // WP4
      T('WP4','4.1 Defining current state of DT methodologies & standards',1,18,'KTH','Review of DT methods/standards from human-centric angle.');
      T('WP4','4.2 Co-designing DT-based methodology for acceptance',6,24,'KTH','Workshops + action research for acceptance-focused method.');
      T('WP4','4.3 Implementing DT-based methodologies in lifecycle of tasks',18,46,'KTH','Industrial implementation across cases.');
      T('WP4','4.4 Verifying & validating DT implementation results',36,46,'KTH','Code/model verification + validation + UQ.');
      D('WP4','D4.1',24,'KTH','DT-based assessment methodology.');
      D('WP4','D4.2',46,'KTH','Evaluation of methodology in demonstrators.');
      MS('WP4','M4.1',12,'KTH','Methodology & standards ready.');
      MS('WP4','M4.2',30,'KTH','Methodology demonstrated in ≥2 demos.');

      // WP5
      T('WP5','5.1 Co-design industrial demonstrators',1,6,'KTH','Cross-case workshops; common templates & protocol.');
      T('WP5','5.2 Shipbuilding use cases & baselines',2,10,'HDKSOE','Personas, work chronicles, KPIs.');
      T('WP5','5.3 Mining use cases & baselines',2,10,'NMT','Operator support, predictive maintenance, training.');
      T('WP5','5.4 Food & beverage use cases & baselines',2,10,'IDL','Decision support; inclusiveness indicators.');
      D('WP5','D5.1',10,'KTH','Consolidated use cases & KPI pack.');
      MS('WP5','M5.1',6,'UoP','Workshops completed.');
      MS('WP5','M5.2',10,'KTH','Use cases & baselines approved.');

      // WP6
      T('WP6','6.1 Needs confirmation & use-case finalisation',6,10,'HDKSOE','Refined scope, KPIs, test plans.');
      T('WP6','6.2 Deployment of human-centric digital solutions',13,32,'HDKSOE','Adapter-based integration into ERP/APS/MES & comms.');
      T('WP6','6.3 Testing & validation in real tasks',19,32,'HDKSOE','Operational + human-centric KPIs; Voice 5.0.');
      D('WP6','D6.1',10,'HDKSOE','Shipbuilding use case & KPI pack.');
      D('WP6','D6.2',33,'HDKSOE','Deployment & validation report.');
      MS('WP6','M6.1',8,'HDKSOE','Use case & KPIs signed off.');
      MS('WP6','M6.2',31,'HDKSOE','Demonstrator deployed & tested.');

      // WP7
      T('WP7','7.1 Pilot roll-out planning & governance',25,28,'HDKSOE','Safety gates, data governance, training.');
      T('WP7','7.2 Staged pilot execution',28,34,'HDKSOE','Shadow → assisted → controlled phases.');
      T('WP7','7.3 Impact measurement & stakeholder evaluation',28,40,'SNU','Voice 5.0 + KPI dashboards; adoption.');
      T('WP7','7.4 Consolidation & scale-up plan',36,42,'HDKSOE','Playbook for replication.');
      D('WP7','D7.1',28,'HDKSOE','Pilot roll-out plan & governance pack.');
      D('WP7','D7.3',42,'SNU','Final impact report & scale-up playbook.');
      MS('WP7','M7.1',28,'HDKSOE','Pilot (shadow) approved.');
      MS('WP7','M7.3',34,'HDKSOE','Controlled deployment completed.');
      MS('WP7','M7.4',42,'HDKSOE','Scale-Up Playbook endorsed.');

      // WP8
      T('WP8','8.1 Needs confirmation & use-case finalisation',6,10,'NMT','Confirm mining use cases; underground Voice 5.0.');
      T('WP8','8.2 Deployment of digital solutions',13,28,'NMT','AI training & troubleshooting tool with IIoT/logs/manuals.');
      T('WP8','8.3 Testing & validation in real tasks',19,32,'NMT','Cognitive load, learning time, MTTR, accuracy.');
      D('WP8','D8.1',10,'NMT','Mining use case & KPI pack.');
      D('WP8','D8.2',33,'NMT','Deployment & test report.');
      MS('WP8','M8.1',8,'NMT','Use case & KPIs finalised.');
      MS('WP8','M8.2',31,'NMT','Demonstrator deployed & tested.');

      // WP9
      T('WP9','9.1 Pilot roll-out planning & governance',25,28,'NMT','Pilot governance; safety; training modules.');
      T('WP9','9.2 Staged pilot execution (shadow→assisted→controlled)',28,34,'NMT','Three phases to full operation.');
      T('WP9','9.3 Impact measurement & stakeholder evaluation',28,40,'KTH','Human-centric + operational impact assessment.');
      T('WP9','9.4 Consolidation & mining scale-up toolkit',36,42,'NMT','Toolkit for replication.');
      D('WP9','D9.1',28,'NMT','Pilot roll-out plan (mining).');
      D('WP9','D9.3',42,'NMT','Final impact & scale-up (mining).');
      MS('WP9','M9.1',28,'NMT','Pilot launch approved.');
      MS('WP9','M9.2',34,'NMT','Controlled deployment completed.');
      MS('WP9','M9.3',42,'NMT','Scale-Up toolkit validated.');

      // WP10
      T('WP10','10.1 Needs confirmation & use-case finalisation',6,10,'IDL','Finalize F&B use cases; journey maps & inclusiveness.');
      T('WP10','10.2 Deployment of human-centric digital solutions',13,28,'IDL','DT integrates sensors/params; NL queries for cuts.');
      T('WP10','10.3 Testing & validation in real distillation tasks',19,32,'IDL','Live production tests; cognitive load & decision accuracy.');
      D('WP10','D10.1',10,'IDL','F&B use case & KPI pack.'); D('WP10','D10.2',33,'IDL','Deployment & test report.');
      MS('WP10','M10.1',8,'IDL','Use case & KPIs finalised.'); MS('WP10','M10.2',31,'IDL','Demonstrator deployed & tested.');

      // WP11
      T('WP11','11.1 Pilot roll-out planning & governance',25,28,'IDL','Pilot plan: training, change management, data governance.');
      T('WP11','11.2 Staged pilot execution (shadow→assisted→controlled)',28,34,'IDL','Phased rollout with coaching & feedback.');
      T('WP11','11.3 Impact measurement & stakeholder evaluation',28,40,'KTH','Cognitive load, inclusiveness, productivity gains.');
      T('WP11','11.4 Consolidation & F&B scale-up playbook',36,42,'IDL','Playbook for replication.');
      D('WP11','D11.1',28,'IDL','Pilot roll-out plan (F&B).'); D('WP11','D11.3',42,'IDL','Final impact & scale-up (F&B).');
      MS('WP11','M11.1',28,'IDL','Pilot launched.'); MS('WP11','M11.2',34,'IDL','Controlled deployment completed.'); MS('WP11','M11.3',42,'IDL','Playbook endorsed.');

      // WP12–14
      T('WP12','12.1 Coordination, management, reporting & committees',1,18,'KTH','Project governance (RP1).');
      T('WP12','12.2 Data management',1,18,'KTH','DMP & FAIR data support.');
      T('WP12','12.3 Risk management',1,18,'KTH','Risk registry & reviews.');
      T('WP12','12.4 Quality management',1,18,'KTH','QAP for deliverables/reports.');
      D('WP12','D12.1',3,'KTH','Project management plan.');
      D('WP12','D12.2',18,'KTH','Management plan update.');
      D('WP12','D12.3',6,'KTH','Data management plan.');
      D('WP12','D12.4',18,'KTH','DMP update at RP1.');
      T('WP13','13.1 Continuation of WP12 tasks in RP2',19,36,'KTH','Coordination, DMP, risk & quality in RP2.');
      D('WP13','D13.1',36,'KTH','Project management plan (RP2).'); D('WP13','D13.2',36,'KTH','DMP update (RP2).');
      T('WP14','14.1 Continuation of WP12/13 tasks in RP3',37,48,'KTH','Coordination, DMP, risk & quality in RP3.');
      D('WP14','D14.1',48,'KTH','Project management plan (RP3).'); D('WP14','D14.2',48,'KTH','DMP update (RP3).');

      data.addRows(rows);

      const options = {
        backgroundColor:'#ffffff',
        timeline:{colorByRowLabel:false, barLabelStyle:{fontSize:12}, rowLabelStyle:{fontSize:12}},
        avoidOverlappingGridLines:false,
        height:1950,
        tooltip:{isHtml:true}
      };

      chart.draw(data, options);

      // selection → details panel
      google.visualization.events.addListener(chart,'select',function(){
        const sel = chart.getSelection();
        const box = document.getElementById('details');
        if(!sel.length){ box.innerHTML = '<span class="muted">Click a bar/marker to see details.</span>'; return; }
        const r = sel[0].row;
        const wp = data.getValue(r,0), item = data.getValue(r,1);
        const rec = registry[`${wp}|${item}`];
        if(!rec){ box.innerHTML = '<span class="muted">No details.</span>'; return; }
        const startTxt = rec.start ? fmt(rec.start) : '';
        const endTxt   = rec.end   ? fmt(rec.end)   : '';
        box.innerHTML = `
          <h3>${rec.label} — <span class="muted">${rec.type}</span></h3>
          <div class="meta">
            <span><strong>WP:</strong> ${rec.wp}</span>
            <span><strong>Lead:</strong> ${rec.lead}</span>
            <span><strong>${rec.type==='Task'?'Start':'Due'}:</strong> ${startTxt}</span>
            <span><strong>${rec.type==='Task'?'End':''}</strong> ${rec.type==='Task'? endTxt : ''}</span>
          </div>
          <p>${rec.desc||''}</p>`;
      });
    }
  </script>
</head>
<body>
  <h2>Gantt — grouped by WP (tasks first, then related deliverables & milestones)</h2>

  <div class="legend">
    
  </div>

  <div id="gantt"></div>
  <div id="details"><span class="muted">Click a bar/marker to see details.</span></div>
</body>
</html>